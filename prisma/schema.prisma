generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL_DEV")
}

model User {
  id              String        @id @default(uuid())
  name            String
  revTag          String        @unique
  color           String
  auth0sub        String?       @unique
  payed           Expense[]     @relation("Payer")
  participatedIn  Participant[]
  transferredTo   Transfer[]    @relation("userTo")
  transferredFrom Transfer[]    @relation("userFrom")
  QR              QR[]
  Owes1           Owes[]        @relation("user1")
  Owes2           Owes[]        @relation("user2")
}

model Expense {
  id      String        @id @default(uuid())
  title   String
  amount  Int
  payerId String
  payer   User          @relation("Payer", fields: [payerId], references: [id])
  items   ExpenseItem[]
  date    String?
}

model ExpenseItem {
  id           String        @id @default(uuid())
  name         String
  price        Int
  participants Participant[]
  expenseId    String
  expense      Expense       @relation(fields: [expenseId], references: [id])
}

model Participant {
  id            String        @id @default(uuid())
  expenseItemId String
  item          ExpenseItem   @relation(fields: [expenseItemId], references: [id])
  userId        String
  user          User          @relation(fields: [userId], references: [id])
  amount        Float
  isAccepted    ExpenseStatus
}

model Transfer {
  id         String  @id @default(uuid())
  title      String
  date       String?
  amount     Int
  userFromId String
  userFrom   User    @relation("userFrom", fields: [userFromId], references: [id])
  userToId   String
  userTo     User    @relation("userTo", fields: [userToId], references: [id])
}

model QR {
  id      String @id @default(uuid())
  amount  Int
  payToId String
  payTo   User   @relation(fields: [payToId], references: [id])
}

enum ExpenseStatus {
  ACCEPTED
  DECLINED
  NONE
}

model Owes {
  id      String @id @default(uuid())
  user1   User   @relation("user1", fields: [user1Id], references: [id]) //if this person pays the owed amount, it is settled
  user2   User   @relation("user2", fields: [user2Id], references: [id])
  amount  Int
  user1Id String
  user2Id String
}
